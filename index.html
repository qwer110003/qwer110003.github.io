âˆâˆâˆ<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <title>ìë¦¬ì–´ë•Œ</title>
        <link href="./index.css" rel="stylesheet">
    </head>
    <body style="padding: 0; margin: 0;">
        <header style="display: flex; background-color: #ffffff; position: fixed; width: 100%; top: 0;">
            <nav class="nav-style">
                <div class="nav-logo">
                    <img src="./ìë¦¬ì–´ë•Œ.svg" class="logo-img">
                </div>
                <div style="display: flex; justify-content: end; align-items: center; width: 100%;">
                    <div class="top-bar">
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="ê°€ê²Œ ê²€ìƒ‰">
                            <button class="search-btn" onclick="toggleSearch()">
                                <img src="./fi-rs-search.svg" class="search-icn">
                            </button>
                        </div>
                        <button class="notification-btn" onclick="toggleNotificationPanel()">
                            <img src="./fi-rs-bell.svg" class="notification-icn">
                        </button>
                    </div>
                </div>
            </nav>
        </header>
        <div id="map" style="width:100%; height: 60vh; margin-top: 9.3vh;"></div>
            <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cf49e414e83e11174542340618560ddf"></script>
            <script>
                var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
                mapOption = { 
                    center: new kakao.maps.LatLng(33.450701, 126.570667), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                    level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
                };

                var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤

                // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤ 
                var markerPosition  = new kakao.maps.LatLng(33.450701, 126.570667); 

                // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                var marker = new kakao.maps.Marker({
                    position: markerPosition
                });

                // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
                marker.setMap(map);
            </script>
        <div class="bottom-sheet" id="bottomSheet">
            <div class="drag-bar" onclick="toggleSheet()"></div>
            <div class="filters">
                <div class="filter-btn-select" onclick="toggleSort('crowd')">
                    <img src="./á„’á…©á†«á„Œá…¡á†¸á„ƒá…©.svg" style=" width: 6.5vw;">
                    <p class="btn-txt">í˜¼ì¡ë„</p>
                    <span id="crowdArrow">â–¼</span>
                </div>
                <div class="filter-btn-unselect" onclick="toggleSort('distance')">
                    <img src="./á„€á…¥á„…á…µá„‰á…®á†«.svg" style=" width: 6.5vw;">
                    <p class="btn-txt">ê±°ë¦¬ìˆœ</p>
                    <span id="distanceArrow">â–¼</span>
                </div>
            </div>
            <div class="store-list" id="storeList"></div>
        </div>
    </body>
</html>
<script>

    const stores = [
        {name: "ì‚¼ì¶˜ë„¤", lat:36.8152, lng:127.1543, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 69", hours: "04:00~04:00", level: "í˜¼ì¡", distance: 120, alert:false},
        {name: "ë©´ì‹ë‹¹", lat:36.8155, lng:127.1546, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 66", hours: "10:30~21:00", level: "ë³´í†µ", distance: 350, alert:false},
        {name: "ì²œì›êµ­ìˆ˜", lat:36.8153, lng:127.1545, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 66", hours: "09:00~20:00", level: "ì—¬ìœ ", distance: 200, alert:false},
        {name: "ì•¼ê°„ì‘ì—…", lat:36.8158, lng:127.1550, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 77", hours: "10:00~22:00", level: "í˜¼ì¡", distance: 500, alert:false},
        {name: "ê³ ê¸°êµ½ëŠ”ì§‘", lat:36.8160, lng:127.1553, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 79", hours: "10:30~21:30", level: "í˜¼ì¡", distance: 250, alert:false}
    ];
    let sortState = { crowd: "desc", distance: "asc" };
    
    function initMap() {
        const center = { lat: 36.8152, lng: 127.1543 };
        const map = new google.maps.Map(document.getElementById("map"), { zoom: 16, center });
    
        stores.forEach(store=>{
            new google.maps.Marker({
                position: { lat: store.lat, lng: store.lng },
                map,
                title: store.name,
                label: ""
            });
        });
    
        renderStoreList(stores);
    }
    
    function isOpen(hours){
        const now = new Date();
        const [open, close] = hours.split("~").map(t=>t.trim());
        const [oh, om] = open.split(":").map(Number);
        const [ch, cm] = close.split(":").map(Number);
        const openTime = oh*60+om;
        const closeTime = ch*60+cm;
        const nowTime = now.getHours()*60+now.getMinutes();
        if(openTime < closeTime){
            return nowTime>=openTime && nowTime<=closeTime;
        } else {
            return nowTime>=openTime || nowTime<=closeTime;
        }
    }
    
    function renderStoreList(list){
        const container = document.getElementById("storeList");
        container.innerHTML = "";
        list.forEach((store)=> {
            const status = isOpen(store.hours) ? "ì˜ì—…ì¤‘" : "ë§ˆê°";
            container.innerHTML += `<div class="store-card"> 
                <div class="store-img"></div>
                <div class="store-info">
                    <div class="store-header">
                        <span>${store.name}</span>
                        <button class="${store.alert?'on':'off'}" onclick="toggleAlert(this, '${store.name}')">${store.alert?'ğŸ””':'ğŸ”•'}</button>
                    </div>
                    <p>${store.address}</p>
                    <p>ì˜ì—…ì‹œê°„: ${store.hours}</p>
                    <p>í˜¼ì¡ë„: <span class="crowd" style="color:${store.level==="í˜¼ì¡"?"red":store.level==="ë³´í†µ"?"orange":"green"}">${store.level}</span> / ìƒíƒœ: ${status}</p>
                </div>
            </div>`;
        });
    }
    
    function toggleSheet(){ document.getElementById("bottomSheet").classList.toggle("open"); }
    
    function toggleSort(type){
        if(type==="crowd"){
            sortState.crowd = sortState.crowd==="desc"?"asc":"desc";
            document.getElementById("crowdArrow").innerText = sortState.crowd==="desc"?"â–¼":"â–²";
            const order = {í˜¼ì¡:3, ë³´í†µ:2, ì—¬ìœ :1};
            const sorted = [...stores].sort((a,b)=> sortState.crowd==="desc"? order[b.level]-order[a.level] : order[a.level]-order[b.level]);
            renderStoreList(sorted);
        } else {
            sortState.distance = sortState.distance==="asc"?"desc":"asc";
            document.getElementById("distanceArrow").innerText = sortState.distance==="asc"?"â–¼":"â–²";
            const sorted = [...stores].sort((a,b)=> sortState.distance==="asc"? a.distance-b.distance : b.distance-a.distance);
            renderStoreList(sorted);
        }
    }
    
    function toggleSearch(){
        const input = document.getElementById("searchInput");
        input.style.display = (input.style.display === "none" || input.style.display === "") ? "inline-block" : "none";
        if(input.style.display === "inline-block") input.focus();
    }
    
    function toggleAlert(btn, storeName){
        const store = stores.find(s => s.name === storeName);
        if(store){
            store.alert = !store.alert;
            btn.textContent = store.alert ? 'ğŸ””' : 'ğŸ”•';
            btn.classList.toggle("on", store.alert);
            btn.classList.toggle("off", !store.alert);
        }
    }
    
    function toggleNotificationPanel(){
        const panel = document.getElementById("notificationPanel");
        panel.style.display = (panel.style.display === "block") ? "none" : "block";
    }
</script>