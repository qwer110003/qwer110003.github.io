âˆâˆâˆ<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <title>ìë¦¬ì–´ë•Œ</title>
        <link href="./index.css" rel="stylesheet">
    </head>
    <body style="padding: 0; margin: 0;">
        <header style="display: flex; background-color: #ffffff; position: fixed; width: 100%; top: 0;">
            <nav class="nav-style">
                <div class="nav-logo">
                    <img src="./ìë¦¬ì–´ë•Œ.svg" class="logo-img">
                </div>
                <div style="display: flex; justify-content: end; align-items: center; width: 100%;">
                    <div class="top-bar">
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="ê°€ê²Œ ê²€ìƒ‰">
                            <button class="search-btn" onclick="toggleSearch()">
                                <img src="./fi-rs-search.svg" class="search-icn">
                            </button>
                        </div>
                        <button class="notification-btn" onclick="toggleNotificationPanel()">
                            <img src="./fi-rs-bell.svg" class="notification-icn">
                        </button>
                    </div>
                </div>
            </nav>
        </header>
        <div id="map" style="width:100%; height: 90vh; margin-top: 9.3vh;"></div>
            <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cf49e414e83e11174542340618560ddf"></script>
            <script>
                var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
                mapOption = { 
                    center: new kakao.maps.LatLng(33.450701, 126.570667), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                    level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
                };

                var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤

                // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤ 
                var markerPosition  = new kakao.maps.LatLng(33.450701, 126.570667); 

                // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                var marker = new kakao.maps.Marker({
                    position: markerPosition
                });

                // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
                marker.setMap(map);
            </script>
        <div class="bottom-sheet" id="bottomSheet">
            <div class="drag-bar" id="dragBar"></div>
            <div class="filters">
                <div class="filter-btn" onclick="toggleSort('crowd')">
                    <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="width: 6.5vw;">
                        <circle cx="12" cy="9" r="4"/>
                        <circle cx="17" cy="9" r="3"/>
                        <circle cx="7" cy="9" r="3"/>
                        <path d="M17 13C19.4478 13.0001 20.4286 15.4456 20.7969 16.916C20.9406 17.4899 20.4862 18 19.8945 18H17.5684C17.1653 16.4903 16.3855 14.778 14.8779 13.7998C15.4201 13.321 16.1137 13 17 13Z"/>
                        <path d="M7 13C7.88599 13 8.57903 13.3212 9.12109 13.7998C7.61395 14.7781 6.83465 16.4905 6.43164 18H4.10449C3.51309 17.9997 3.05944 17.4898 3.20312 16.916C3.57139 15.4456 4.55216 13 7 13Z"/>
                        <path d="M12 14C15.7087 14 16.6665 17.301 16.9139 19.0061C16.9932 19.5526 16.5523 20 16 20H8C7.44772 20 7.00684 19.5526 7.08614 19.0061C7.33351 17.301 8.29134 14 12 14Z"/>
                    </svg>                        
                    <p class="btn-txt">í˜¼ì¡ë„</p>
                    <img src="./arrow.svg" style="width: 6.5vw;" id="crowdArrow">
                </div>
                <div class="filter-btn" onclick="toggleSort('distance')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C15.866 2 19 5.13401 19 9C19 14.0159 13.8819 17.0342 12.3984 17.8037C12.1456 17.9349 11.8544 17.9349 11.6016 17.8037C10.1181 17.0342 5 14.0159 5 9C5 5.13401 8.13401 2 12 2ZM12 6C10.3431 6 9 7.34315 9 9C9 10.6569 10.3431 12 12 12C13.6569 12 15 10.6569 15 9C15 7.34315 13.6569 6 12 6Z" fill="currentColor"/>
                        <path d="M18.0622 16.5C18.6766 16.9561 19 17.4734 19 18C19 18.5266 18.6766 19.0439 18.0622 19.5C17.4478 19.9561 16.5641 20.3348 15.5 20.5981C14.4359 20.8614 13.2288 21 12 21C10.7712 21 9.56414 20.8614 8.5 20.5981C7.43587 20.3348 6.5522 19.9561 5.93782 19.5C5.32344 19.0439 5 18.5266 5 18C5 17.4734 5.32344 16.9561 5.93782 16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>                                                
                    <p class="btn-txt">ê±°ë¦¬ìˆœ</p>
                    <img src="./arrow.svg" style="width: 6.5vw;" id="distanceArrow">
                </div>
            </div>
            <div class="store-list" id="storeList"></div>
        </div>
    </body>
</html>
<script>

    const stores = [
        {name: "ì‚¼ì¶˜ë„¤", lat:36.8152, lng:127.1543, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 69", hours: "04:00~04:00", level: "í˜¼ì¡", distance: 120, alert:false},
        {name: "ë©´ì‹ë‹¹", lat:36.8155, lng:127.1546, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 66", hours: "10:30~21:00", level: "ë³´í†µ", distance: 350, alert:false},
        {name: "ì²œì›êµ­ìˆ˜", lat:36.8153, lng:127.1545, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 66", hours: "09:00~20:00", level: "ì—¬ìœ ", distance: 200, alert:false},
        {name: "ì•¼ê°„ì‘ì—…", lat:36.8158, lng:127.1550, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 77", hours: "10:00~22:00", level: "í˜¼ì¡", distance: 500, alert:false},
        {name: "ê³ ê¸°êµ½ëŠ”ì§‘", lat:36.8160, lng:127.1553, address: "ì¶©ë‚¨ ì²œì•ˆì‹œ ë™ë‚¨êµ¬ ë¬¸ì•”ë¡œ 79", hours: "10:30~21:30", level: "í˜¼ì¡", distance: 250, alert:false}
    ];
    let sortState = { crowd: "desc", distance: "asc" };
    
    function initMap() {
        const center = { lat: 36.8152, lng: 127.1543 };
        const map = new google.maps.Map(document.getElementById("map"), { zoom: 16, center });
    
        stores.forEach(store=>{
            new google.maps.Marker({
                position: { lat: store.lat, lng: store.lng },
                map,
                title: store.name,
                label: ""
            });
        });
    
        renderStoreList(stores);
    }
    
    function isOpen(hours){
        const now = new Date();
        const [open, close] = hours.split("~").map(t=>t.trim());
        const [oh, om] = open.split(":").map(Number);
        const [ch, cm] = close.split(":").map(Number);
        const openTime = oh*60+om;
        const closeTime = ch*60+cm;
        const nowTime = now.getHours()*60+now.getMinutes();
        if(openTime < closeTime){
            return nowTime>=openTime && nowTime<=closeTime;
        } else {
            return nowTime>=openTime || nowTime<=closeTime;
        }
    }
    
    function renderStoreList(list){
        const container = document.getElementById("storeList");
        container.innerHTML = "";
        list.forEach((store)=> {
            const status = isOpen(store.hours) ? "ì˜ì—…ì¤‘" : "ë§ˆê°";
            container.innerHTML += `<div class="store-card"> 
                <div class="store-img"></div>
                <div class="store-info">
                    <div class="store-header">
                        <span>${store.name}</span>
                        <button class="${store.alert?'on':'off'}" onclick="toggleAlert(this, '${store.name}')">${store.alert?'ğŸ””':'ğŸ”•'}</button>
                    </div>
                    <p>${store.address}</p>
                    <p>ì˜ì—…ì‹œê°„: ${store.hours}</p>
                    <p>í˜¼ì¡ë„: <span class="crowd" style="color:${store.level==="í˜¼ì¡"?"red":store.level==="ë³´í†µ"?"orange":"green"}">${store.level}</span> / ìƒíƒœ: ${status}</p>
                </div>
            </div>`;
        });
    }
    
    const sheet = document.getElementById("bottomSheet");
    const dragBar = document.getElementById("dragBar");

    let startY = 0;
    let currentY = 0;
    let isDragging = false;
    let moved = false; // ë“œë˜ê·¸ ì—¬ë¶€ í™•ì¸ìš©
    let maxY = window.innerHeight * 0.6;

    function toggleSheet() {
        sheet.classList.toggle("open");
    }

    function dragStart(e) {
        startY = e.touches ? e.touches[0].clientY : e.clientY;
        isDragging = true;
        moved = false;
        sheet.style.transition = "none"; // ë“œë˜ê·¸ ì¤‘ì—ëŠ” transition ì œê±°
    }

    function dragMove(e) {
    if (!isDragging) return;
        e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€

    let clientY = e.touches ? e.touches[0].clientY : e.clientY;
        currentY = clientY - startY;

    if (Math.abs(currentY) > 5) moved = true; // 5px ì´ìƒ ì›€ì§ì´ë©´ ë“œë˜ê·¸ë¡œ ê°„ì£¼

    let baseY = sheet.classList.contains("open") ? 0 : maxY;
    let moveY = baseY + currentY;

    if (moveY < 0) moveY = 0;
    if (moveY > window.innerHeight * 0.6) moveY = maxY;

    sheet.style.transform = `translateY(${moveY}px)`;
    }

    function dragEnd() {
        if (!isDragging) return;
        isDragging = false;
        sheet.style.transition = "transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1)";

        if (!moved) {
            // ì›€ì§ì„ì´ ê±°ì˜ ì—†ì—ˆë‹¤ë©´ â†’ í´ë¦­ìœ¼ë¡œ ì²˜ë¦¬
            toggleSheet();
            return;
        }

        // ë“œë˜ê·¸ì˜€ë‹¤ë©´ ìŠ¤ëƒ… ë™ì‘
        if (currentY > maxY * 0.3) {
            sheet.classList.remove("open");
            sheet.style.transform = `translateY(${maxY}px)`;
        } else {
            sheet.classList.add("open");
            sheet.style.transform = `translateY(0)`;
        }
        currentY = 0;
    }

    // ì´ë²¤íŠ¸ ë“±ë¡
    dragBar.addEventListener("mousedown", dragStart);
    document.addEventListener("mousemove", dragMove);
    document.addEventListener("mouseup", dragEnd);

    dragBar.addEventListener("touchstart", dragStart);
    document.addEventListener("touchmove", dragMove, { passive: false });
    document.addEventListener("touchend", dragEnd);

    window.addEventListener('resize', () => {
        maxY = window.innerHeight * 0.6;
    });

    function toggleSort(type){
        if(type==="crowd"){
            sortState.crowd = sortState.crowd==="desc"?"asc":"desc";
            document.getElementById("crowdArrow").src = sortState.crowd==="desc" ? "./arrow.svg":"./arrow-up.svg";
            const order = {í˜¼ì¡:3, ë³´í†µ:2, ì—¬ìœ :1};
            const sorted = [...stores].sort((a,b)=> sortState.crowd==="desc"? order[b.level]-order[a.level] : order[a.level]-order[b.level]);
            renderStoreList(sorted);
        } else {
            sortState.distance = sortState.distance==="asc"?"desc":"asc";
            document.getElementById("distanceArrow").src = sortState.distance==="asc" ? "./arrow.svg":"./arrow-up.svg";
            const sorted = [...stores].sort((a,b)=> sortState.distance==="asc"? a.distance-b.distance : b.distance-a.distance);
            renderStoreList(sorted);
        }
    }
    
    function toggleSearch(){
        const input = document.getElementById("searchInput");
        input.style.display = (input.style.display === "none" || input.style.display === "") ? "inline-block" : "none";
        if(input.style.display === "inline-block") input.focus();
    }
    
    function toggleAlert(btn, storeName){
        const store = stores.find(s => s.name === storeName);
        if(store){
            store.alert = !store.alert;
            btn.textContent = store.alert ? 'ğŸ””' : 'ğŸ”•';
            btn.classList.toggle("on", store.alert);
            btn.classList.toggle("off", !store.alert);
        }
    }
    
    function toggleNotificationPanel(){
        const panel = document.getElementById("notificationPanel");
        panel.style.display = (panel.style.display === "block") ? "none" : "block";
    }

    const buttons = document.querySelectorAll(".filter-btn");

    buttons.forEach(btn => {
        btn.addEventListener("click", () => {
            // ëª¨ë“  ë²„íŠ¼ active í•´ì œ
            buttons.forEach(b => b.classList.remove("active"));

            // í´ë¦­í•œ ë²„íŠ¼ì— active ì¶”ê°€
            btn.classList.add("active");

            // í™”ì‚´í‘œ í† ê¸€ (ì˜¤ë¦„/ë‚´ë¦¼)
            const arrow = btn.querySelector(".arrow");
            if (arrow.classList.contains("up")) {
            arrow.classList.remove("up");
            arrow.classList.add("down");
            } else {
            arrow.classList.remove("down");
            arrow.classList.add("up");
            }
        });
    });
</script>